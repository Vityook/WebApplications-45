<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sneakers Shop</title>
    <link rel="stylesheet" href="shoes.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <section>
        <nav>
            <div class="logo">
                <h1>Sneaker<span>s</span></h1>
            </div>

            <ul>
                <li><a href="#home">Home</a></li>
                <li><a href="#products">Products</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#Review">Review</a></li>
                <li><a href="#Services">Services</a></li>
                <% if (isAuthenticated && user.role === 'admin') { %>
                    <li><a href="/admin/panel" class="admin-button">Admin Panel</a></li>
                <% } %>
            </ul>

            <div class="icons">
                <i class="fa-solid fa-heart"></i>
                <i class="fa-solid fa-cart-shopping"></i>
                <% if (isAuthenticated) { %>
                    <a href="/auth/logout"><i class="fa-solid fa-sign-out-alt"></i></a>
                <% } else { %>
                    <i class="fa-solid fa-user" id="user-icon"></i>
                <% } %>
            </div>
        </nav>

        <% if (!isAuthenticated) { %>
            <!-- Login and Register Popup -->
            <div class="popup-container" id="popupContainer">
                <div class="popup-content">
                    <span class="close" id="closePopup">&times;</span>
    
                    <!-- Login Form -->
                    <form id="loginForm">
                        <h2>Login</h2>
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" required>
                        <label for="password">Password:</label>
                        <input type="password" id="password" name="password" required>
                        <button type="submit">Login</button>
                        <p>Don't have an account? <a href="#" id="showRegisterForm">Register here</a></p>
                    </form>
    
                    <!-- Registration Form -->
                    <div id="registerForm" style="display: none;">
                        <h2>Register</h2>
                        <form id="registerFormSubmit">
                            <label for="reg-username">Username:</label>
                            <input type="text" id="reg-username" name="username" required>
                            <label for="reg-email">Email:</label>
                            <input type="email" id="reg-email" name="email" required>
                            <label for="reg-password">Password:</label>
                            <input type="password" id="reg-password" name="password" required>
                            <button type="submit">Register</button>
                        </form>
                        <p>Already have an account? <a href="#" id="showLoginForm">Login here</a></p>
                    </div>
                </div>
            </div>
        <% } %>

        <div class="main" id="Home">
            <div class="main_content">
                <div class="main_text">
                    <h1>Shoes<br><span>Collection</span></h1>
                    <p>
                        Welcome to our sneakers shop,
                        where passion for sneakers meets unparalleled style and innovation.
                        Whether you're a seasoned sneakerhead or just starting your collection,
                        our curated selection offers something for everyone. From classic designs to the latest drops,
                        we bring you the finest in comfort, craftsmanship, and cutting-edge trends. Step into a world where every pair tells a story,
                        and let your sneakers do the talking.
                        Discover your next favorite pair today, and elevate your sneaker game to new heights.
                    </p>
                </div>
                <div class="main_image">
                    <img src="images/img1.png">
                </div>
            </div>
            <div class="social_icon">
                <i class="fa-brands fa-facebook"></i>
                <i class="fa-brands fa-twitter"></i>
                <i class="fa-brands fa-instagram"></i>
            </div>
        </div>
    </section>

    <div class="box">
        <div class="products" id="Prod">
            <h1>Latest & Greatest</h1>
        
            <div class="box">
                <% for (let i = 0; i < products.length; i++) { %>
                    <div class="card">
                        <div class="small_card">
                            <i class="fa-solid <%= products[i].isFavorite ? 'fa-heart' : 'fa-heart' %>"></i>
                        </div>
        
                        <div class="image">
                            <img src="<%= products[i].imageSrc %>" alt="<%= products[i].name %>">
                        </div>
                       
                        <div class="product_text">
                            <h2><%= products[i].name %></h2>
                            <h3><%= products[i].price %></h3>
                            <a class="link" href="/shoe?id=<%= products[i].id %>">Show</a>
                            <% if (isAuthenticated) { %>
                                <a class="link" href="/deleteshoe?id=<%= products[i].id %>">Delete</a>
                            <% } %>
                            <div class="stars">
                                <% for(let j = 0; j < products[i].rating; j++) { %>
                                    <i class="fa-solid fa-star"></i>
                                <% } %>
                            </div>
                            <a href="#" class="btn">Add To Cart</a>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    </div>


    <script>
        const loginIcon = document.getElementById('user-icon');
        const popupContainer = document.getElementById('popupContainer');
        const closePopup = document.getElementById('closePopup');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const showRegisterForm = document.getElementById('showRegisterForm');
        const showLoginForm = document.getElementById('showLoginForm');

        function showPopup() {
            if (popupContainer) {
                popupContainer.style.display = 'flex';
            }
        }

        function hidePopup() {
            if (popupContainer) {
                popupContainer.style.display = 'none';
            }
        }

        if (loginIcon) {
            loginIcon.addEventListener('click', showPopup);
        }

        if (closePopup) {
            closePopup.addEventListener('click', hidePopup);
        }

        window.addEventListener('click', (event) => {
            if (event.target === popupContainer) {
                hidePopup();
            }
        });

        if (showRegisterForm) {
            showRegisterForm.addEventListener('click', (e) => {
                e.preventDefault();
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
            });
        }

        if (showLoginForm) {
            showLoginForm.addEventListener('click', (e) => {
                e.preventDefault();
                registerForm.style.display = 'none';
                loginForm.style.display = 'block';
            });
        }

        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            axios.post('/auth/login', { email, password })
                .then(response => {
                    alert('Login successful!');
                    window.location.href = '/'; // Redirect to home page
                })
                .catch(error => {
                    alert('Login failed: ' + (error.response ? error.response.data : error.message));
                });
        });

        const registerFormSubmit = document.getElementById('registerFormSubmit');
        if (registerFormSubmit) {
            registerFormSubmit.addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('reg-username').value;
                const email = document.getElementById('reg-email').value;
                const password = document.getElementById('reg-password').value;
                
                axios.post('/auth/register', { username, email, password })
                    .then(response => {
                        alert('Registration successful! Please log in.');
                        registerForm.style.display = 'none';
                        loginForm.style.display = 'block';
                    })
                    .catch(error => {
                        alert('Registration failed: ' + (error.response ? error.response.data : error.message));
                    });
            });
        }

            document.addEventListener('DOMContentLoaded', function() {
        const adminButton = document.querySelector('.admin-button');
        if (adminButton) {
            // Check if we have user data available
            const userDataElement = document.getElementById('userData');
            if (userDataElement) {
                const userData = JSON.parse(userDataElement.textContent);
                if (!userData.isAdmin) {
                    adminButton.style.display = 'none';
                }
            } else {
                // If we can't verify admin status, hide the button
                adminButton.style.display = 'none';
            }
        }
    });
    </script>
    <script id="userData" type="application/json">
        <%- JSON.stringify({ isAdmin: user && user.role === 'admin' }) %>
    </script>
</body>
</html>