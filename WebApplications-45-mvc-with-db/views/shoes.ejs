<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sneakers Shop</title>
    <link rel="stylesheet" href="shoes.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <section>
        <nav>
            <div class="logo">
                <h1>Sneaker<span>s</span></h1>
            </div>

            <ul>
                <li><a href="#home" id="homeLink">Home</a></li>
                <li><a href="#about" id="aboutLink">About</a></li>
                <li><a href="#Review" id="reviewLink">Review</a></li>
                <li><a href="#services">Services</a></li>
                <% if (isAuthenticated && user.role === 'admin') { %>
                    <li><a href="/admin/panel" class="admin-button">Admin Panel</a></li>
                <% } %>
            </ul>

            <div class="icons">
                <i class="fa-solid fa-heart" id="heartIcon"></i> 
                <i class="fa-solid fa-cart-shopping" id="cartIcon"></i>
                <% if (isAuthenticated) { %>
                    <a href="/auth/logout"><i class="fa-solid fa-sign-out-alt"></i></a>
                <% } else { %>
                    <i class="fa-solid fa-user" id="user-icon"></i>
                <% } %>
            </div>
        </nav>

        <div id="preferredShoesPopup" class="preferred-popup" style="display: none;">
            <h2>Favorites</h2>
            <div id="preferredShoesContainer"></div>
        </div>
        <!-- Login and Register Popup -->
        <% if (!isAuthenticated) { %>
            <div class="popup-container" id="popupContainer">
                <div class="popup-content">
                    <span class="close" id="closePopup">&times;</span>
                    <form id="loginForm">
                        <h2>Login</h2>
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" required>
                        <label for="password">Password:</label>
                        <input type="password" id="password" name="password" required>
                        <button type="submit">Login</button>
                        <p>Don't have an account? <a href="#" id="showRegisterForm">Register here</a></p>
                    </form>
                    <div id="registerForm" style="display: none;">
                        <h2>Register</h2>
                        <form>
                            <label for="reg-username">Username:</label>
                            <input type="text" id="reg-username" name="username" required>
                            <label for="reg-email">Email:</label>
                            <input type="email" id="reg-email" name="email" required>
                            <label for="reg-password">Password:</label>
                            <input type="password" id="reg-password" name="password" required>
                            <button type="submit">Register</button>
                        </form>
                        <p>Already have an account? <a href="#" id="showLoginForm">Login here</a></p>
                    </div>
                </div>
            </div>
        <% } %>

        <!-- Cart Popup Modal (initially hidden) -->
        <div id="cartPopup" class="popup-container" style="display: none;">
            <div class="popup-content">
                <span class="close" id="closeCartPopup">&times;</span>
                <h2>Your Shopping Cart</h2>
                <div id="cartItems">
                    <!-- Cart items will be dynamically inserted here -->
                </div>
                <p>Total: <span id="cartTotal">0 </span></p>
                <button id="checkoutBtn">Proceed to Checkout</button>
            </div>
        </div>

        <!-- Preferred Shoes Popup (initially hidden) -->
        <div id="preferredShoesPopup" class="preferred-popup" style="display: none;">
            <h2>Favorites</h2>
            <div id="preferredShoesContainer"></div>
        </div>

        <div class="main" id="Home">
            <div class="main_content">
                <div class="main_text">
                    <h1>Shoes<br><span>Collection</span></h1>
                    <p>
                        Welcome to our sneakers shop,
                        where passion for sneakers meets unparalleled style and innovation.
                        Whether you're a seasoned sneakerhead or just starting your collection,
                        our curated selection offers something for everyone. From classic designs to the latest drops,
                        we bring you the finest in comfort, craftsmanship, and cutting-edge trends.
                    </p>
                </div>
                <div class="main_image">
                    <img src="images/img1.png">
                </div>
            </div>
            <div class="social_icon">
                <i class="fa-brands fa-facebook"></i>
                <i class="fa-brands fa-twitter"></i>
                <i class="fa-brands fa-instagram"></i>
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <div class="box">
        <div class="products" id="Prod">
            <h1>Latest & Greatest</h1>
            <div class="box">
                <% for (let i = 0; i < products.length; i++) { %>
                    <div class="card">
                        <div class="small_card">
                            <i class="fa-solid <%= products[i].isFavorite ? 'fa-heart' : 'fa-heart' %>"></i>
                        </div>
                        <div class="image">
                            <img src="<%= products[i].imageSrc %>" alt="<%= products[i].name %>">
                        </div>
                        <div class="product_text">
                            <h2><%= products[i].name %></h2>
                            <h3><%= products[i].price %></h3>
                            <a class="link" href="/shoe?id=<%= products[i].id %>">Show</a>
                            <% if (user && user.role === 'admin') { %>
                                <a class="link" href="/deleteshoe?id=<%= products[i].id %>">Delete</a>
                            <% } %>
                            <div class="stars">
                                <% for(let j = 0; j < products[i].rating; j++) { %>
                                    <i class="fa-solid fa-star"></i>
                                <% } %>
                            </div>
                            <a href="#" class="btn addToCartBtn" 
                               data-name="<%= products[i].name %>" 
                               data-price="<%= products[i].price %>" 
                               data-image="<%= products[i].imageSrc %>">Add To Cart</a>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    </div>

    <script>
        const loginIcon = document.getElementById('user-icon');
        const popupContainer = document.getElementById('popupContainer');
        const closePopup = document.getElementById('closePopup');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const showRegisterForm = document.getElementById('showRegisterForm');
        const showLoginForm = document.getElementById('showLoginForm');

        function showPopup() {
            if (popupContainer) {
                popupContainer.style.display = 'flex';
            }
        }

        function hidePopup() {
            if (popupContainer) {
                popupContainer.style.display = 'none';
            }
        }

        if (loginIcon) {
            loginIcon.addEventListener('click', showPopup);
        }

        if (closePopup) {
            closePopup.addEventListener('click', hidePopup);
        }

        window.addEventListener('click', (event) => {
            if (event.target === popupContainer) {
                hidePopup();
            }
        });

        if (showRegisterForm) {
            showRegisterForm.addEventListener('click', (e) => {
                e.preventDefault();
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
            });
        }

        if (showLoginForm) {
            showLoginForm.addEventListener('click', (e) => {
                e.preventDefault();
                registerForm.style.display = 'none';
                loginForm.style.display = 'block';
            });
        }

        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            axios.post('/auth/login', { email, password })
                .then(response => {
                    alert('Login successful!');
                    window.location.href = '/'; // Redirect to home page
                })
                .catch(error => {
                    alert('Login failed: ' + (error.response ? error.response.data : error.message));
                });
        });

        const registerFormSubmit = document.getElementById('registerFormSubmit');
        if (registerFormSubmit) {
            registerFormSubmit.addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('reg-username').value;
                const email = document.getElementById('reg-email').value;
                const password = document.getElementById('reg-password').value;
                
                axios.post('/auth/register', { username, email, password })
                    .then(response => {
                        alert('Registration successful! Please log in.');
                        registerForm.style.display = 'none';
                        loginForm.style.display = 'block';
                    })
                    .catch(error => {
                        alert('Registration failed: ' + (error.response ? error.response.data : error.message));
                    });
            });
        }

            document.addEventListener('DOMContentLoaded', function() {
        const adminButton = document.querySelector('.admin-button');
        if (adminButton) {
            // Check if we have user data available
            const userDataElement = document.getElementById('userData');
            if (userDataElement) {
                const userData = JSON.parse(userDataElement.textContent);
                if (!userData.isAdmin) {
                    adminButton.style.display = 'none';
                }
            } else {
                // If we can't verify admin status, hide the button
                adminButton.style.display = 'none';
            }
        }
    });
    </script>
    <script id="userData" type="application/json">
        <%- JSON.stringify({ isAdmin: user && user.role === 'admin' }) %>
    </script>

    <script>
        // Get elements

        const login_Icon = document.getElementById('user-icon');
        const popup_Container = document.getElementById('popupContainer');
        const close_Popup = document.getElementById('closePopup');
        const login_Form = document.getElementById('loginForm');
        const register_Form = document.getElementById('registerForm');
        const showRegister_Form = document.getElementById('showRegisterForm');
        const showLogin_Form = document.getElementById('showLoginForm');
        // Show the popup when the user icon is clicked
        loginIcon.addEventListener('click', () => {
            popupContainer.style.display = 'flex';
        });
    
        // Hide the popup when the close button is clicked
        closePopup.addEventListener('click', () => {
            popupContainer.style.display = 'none';
        });
    
        // Hide the popup if the user clicks outside the popup content
        window.addEventListener('click', (event) => {
            if (event.target === popupContainer) {
                popupContainer.style.display = 'none';
            }
        });
    
        // Show registration form when 'Register here' is clicked
        showRegisterForm.addEventListener('click', (e) => {
            e.preventDefault();
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
        });
    
        // Show login form when 'Login here' is clicked
        showLoginForm.addEventListener('click', (e) => {
            e.preventDefault();
            registerForm.style.display = 'none';
            loginForm.style.display = 'block';
        });
    
        // about page js // Get references to elements
        const aboutLink = document.getElementById('aboutLink');
    
        // Event listener for the "About" link
        aboutLink.addEventListener('click', (event) => {
            event.preventDefault(); // Prevent default link behavior
    
            // Redirect to the About page
            window.location.href = '/about';
        });
    
    
    
        // about review
         // Get references to elements
         const reviewLink = document.getElementById('reviewLink');
    
         // Event listener for the "About" link
         reviewLink.addEventListener('click', (event) => {
             event.preventDefault(); // Prevent default link behavior
     
             // Redirect to the About page
            window.location.href = '/review';
         });
            
    
         ////////////
         document.addEventListener('DOMContentLoaded', () => {
            const hearts = document.querySelectorAll('.fa-heart'); // Select all heart icons on products
            const preferredShoesContainer = document.getElementById('preferredShoesContainer'); // Container for favorite shoes
            const heartIcon = document.getElementById('heartIcon'); // Heart icon at the top
            const preferredShoesPopup = document.getElementById('preferredShoesPopup'); // Popup for preferred shoes
            let preferredShoes = []; // Array to hold preferred shoes
            
            // Add click event listener for each heart icon (on each shoe)
            hearts.forEach((heart) => {
                heart.addEventListener('click', function () {
                    const productCard = this.closest('.card'); // Get the clicked product card
                    const productName = productCard.querySelector('h2').innerText; // Get product name
                    const productImage = productCard.querySelector('img').src; // Get product image
        
                    // Check if the shoe is already in the preferredShoes array by comparing name and image
                    const existingShoe = preferredShoes.find(shoe => shoe.name === productName && shoe.image === productImage);
                    if (!existingShoe) {
                        // Add to preferred shoes array if not already added
                        preferredShoes.push({ name: productName, image: productImage });
                        
                        // Update heart icon to show number of preferred shoes
                        heartIcon.setAttribute('data-count', preferredShoes.length);
                        heartIcon.classList.add('with-preferred'); // Add class to style it differently if needed
                    }
                });
            });
        
            // Show preferred shoes popup when heart icon is clicked
            heartIcon.addEventListener('click', () => {
                showPreferredShoes(); // Render the preferred shoes
                preferredShoesPopup.style.display = 'block'; // Ensure popup stays visible
            });
        
            // Function to re-render the preferred shoes popup
            function showPreferredShoes() {
                preferredShoesContainer.innerHTML = ''; // Clear current list
        
                // Repopulate the preferred shoes in the popup
                preferredShoes.forEach((shoe, index) => {
                    const shoeDiv = document.createElement('div');
                    shoeDiv.innerHTML = `
                        <img src="${shoe.image}" alt="${shoe.name}">
                        <p>${shoe.name}</p>
                        <button class="remove-shoe" data-index="${index}">Remove</button>
                    `;
                    preferredShoesContainer.appendChild(shoeDiv);
                });
        
                // Add event listener for remove buttons
                const removeButtons = document.querySelectorAll('.remove-shoe');
                removeButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        const shoeIndex = e.target.getAttribute('data-index');
                        preferredShoes.splice(shoeIndex, 1); // Remove the shoe from the array
        
                        // Update the heart icon count
                        heartIcon.setAttribute('data-count', preferredShoes.length);
                        if (preferredShoes.length === 0) {
                            heartIcon.classList.remove('with-preferred'); // Remove style if no favorites
                        }
        
                        // Re-render the preferred shoes popup without closing it
                        showPreferredShoes(); // Refresh the popup content
                    });
                });
            }
        
            // Close the popup if user clicks outside of it, but not when removing a shoe
            window.addEventListener('click', (event) => {
                // Check if the click was outside the popup and not on the heart icon or remove button
                if (event.target !== heartIcon && !preferredShoesPopup.contains(event.target) && !event.target.classList.contains('remove-shoe')) {
                    preferredShoesPopup.style.display = 'none';
                }
            });
        });
        
        // home click
        document.addEventListener('DOMContentLoaded', () => {
            const homeLink = document.getElementById('homeLink'); // Get the "Home" <a> element
        
            // Add a click event listener to the "Home" link
            homeLink.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent the default link behavior
                window.location.reload(); // Refresh the current page
            });
        });
    
    
        /////////////////////////
    // Initialize an array to store cart items
    let cartItemsArray = [];
    
    // Get elements related to the cart popup
    const cartIcon = document.getElementById("cartIcon");
    const cartPopup = document.getElementById("cartPopup");
    const closeCartPopup = document.getElementById("closeCartPopup");
    const cartItems = document.getElementById("cartItems");
    const cartTotal = document.getElementById("cartTotal");
    
    // Get all Add to Cart buttons
    const addToCartBtns = document.querySelectorAll(".addToCartBtn");
    
    // Add event listeners to each "Add to Cart" button
    addToCartBtns.forEach(button => {
      button.addEventListener("click", function(event) {
        event.preventDefault(); // Prevent default anchor behavior
    
        // Get product details from data attributes
        const itemName = this.getAttribute("data-name");
        const itemPrice = parseFloat(this.getAttribute("data-price"));
        const itemImage = this.getAttribute("data-image");
    
        // Add item to the cart array
        cartItemsArray.push({ name: itemName, price: itemPrice, image: itemImage });
    
        // Update the cart popup
        updateCart();
      });
    });
    
    // Function to update the cart popup
    function updateCart() {
      // Clear existing items in the popup
      cartItems.innerHTML = "";
    
      // Add each item to the cart popup
      let total = 0;
      cartItemsArray.forEach((item, index) => {
        const itemElement = document.createElement("div");
        itemElement.classList.add("cart-item");
        itemElement.innerHTML = `
          <img src="${item.image}" alt="${item.name}" class="cart-item-image">
          <p>${item.name} - $${item.price}</p>
          <button class="remove-item" data-index="${index}">Remove</button>
        `;
        cartItems.appendChild(itemElement);
        total += item.price;
      });
    
      // Update the total price in the popup
      cartTotal.textContent = "$" + total.toFixed(2);
    
      // Add event listeners for the remove buttons
      const removeButtons = document.querySelectorAll(".remove-item");
      removeButtons.forEach(button => {
        button.addEventListener("click", function() {
          const index = parseInt(this.getAttribute("data-index"));
          removeFromCart(index);
        });
      });
    }
    
    // Function to remove an item from the cart
    function removeFromCart(index) {
      cartItemsArray.splice(index, 1); // Remove the item at the given index
      updateCart(); // Update the cart popup after removal
    }
    
    // Show the cart popup when the cart icon is clicked
    cartIcon.onclick = function () {
      cartPopup.style.display = "block";
    };
    
    // Close the cart popup when the close button is clicked
    closeCartPopup.onclick = function () {
      cartPopup.style.display = "none";
    };
    
    // Close the popup when clicking outside of the popup content
    window.onclick = function (event) {
      if (event.target == cartPopup) {
        cartPopup.style.display = "none";
      }
    }
    </script>


</body>
</html>