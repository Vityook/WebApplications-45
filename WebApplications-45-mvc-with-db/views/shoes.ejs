<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sneakers Shop</title>
    <link rel="stylesheet" href="shoes.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <section>
        <nav>
            <div class="logo">
                <h1>Sneaker<span>s</span></h1>
            </div>

            <ul>
                <li><a href="#home" id="homeLink">Home</a></li>
                <li><a href="/about" id="aboutLink">About</a></li>
                <li><a href="/Review" id="reviewLink">Review</a></li>
                <li><a href="/services" id="servicesLink">Services</a></li>
                <% if (isAuthenticated && user.role === 'admin') { %>
                    <li><a href="/admin/panel" class="admin-button">Admin Panel</a></li>
                <% } %>
            </ul>

            <div class="icons">
                <% if (isAuthenticated) { %>
                    <i id="heartIcon" class="fa-solid fa-heart" ></i> 
                    <i id="cartIcon" class="fa-solid fa-cart-shopping" ></i>
                    <a href="/auth/logout"><i class="fa-solid fa-sign-out-alt"></i></a>
                <% } else { %>
                    <i class="fa-solid fa-user" id="user-icon"></i>
                <% } %>
            </div>
        </nav>

        <!-- <div class="search-container">
            <input type="text" id="searchInput" placeholder="Search for shoes by name...">
        </div> -->

        <!-- <div id="preferredShoesPopup" class="preferred-popup" style="display: none;">
            <h2>Favorites</h2>
            <div id="preferredShoesContainer"></div>
        </div> -->
        <!-- Login and Register Popup -->
        <% if (!isAuthenticated) { %>
            <div class="popup-container" id="popupContainer">
                <div class="popup-content">
                    <span class="close" id="closePopup">&times;</span>
                    <form id="loginForm">
                        <h2>Login</h2>
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" required>
                        <label for="password">Password:</label>
                        <input type="password" id="password" name="password" required>
                        <button type="submit">Login</button>
                        <p>Don't have an account? <a href="#" id="showRegisterForm">Register here</a></p>
                    </form>
                    <div id="registerForm" style="display: none;">
                        <h2>Register</h2>
                        <form id="registerFormSubmit">
                            <label for="reg-username">Username:</label>
                            <input type="text" id="reg-username" name="username" required>
                            <label for="reg-email">Email:</label>
                            <input type="email" id="reg-email" name="email" required>
                            <label for="reg-password">Password:</label>
                            <input type="password" id="reg-password" name="password" required>
                            <button type="submit">Register</button>
                        </form>
                        <p>Already have an account? <a href="#" id="showLoginForm">Login here</a></p>
                    </div>
                </div>
            </div>
        <% } %>

        <!-- Cart Popup Modal -->
        <% if (isAuthenticated) { %>
            <div id="cartPopup" class="popup-container" style="display: none;">
                <div class="popup-content">
                    <span class="close" id="closeCartPopup">&times;</span>
                    <h2>Your Shopping Cart</h2>
                    <div id="cartItems">
                        <!-- Cart items will be dynamically inserted here -->
                    </div>
                    <p>Total: <span id="cartTotal">0 </span></p>
                    <button id="checkoutBtn">Proceed to Checkout</button>
                </div>
            </div>
        <% } %>

        <!-- Preferred Shoes Popup (initially hidden) -->
        <% if (isAuthenticated) { %>
            <div id="preferredShoesPopup" class="preferred-popup" style="display: none;">
                <span class="close" id="closepreferredPopup">&times;</span>
                <h2>Favorites</h2>
                <div id="preferredShoesContainer"></div>
            </div>
        <% } %>

        <div class="main" id="Home">
            <div class="main_content">
                <div class="main_text">
                    <h1>Shoes<br><span>Collection</span></h1>
                    <p>
                        Welcome to our sneakers shop,
                        where passion for sneakers meets unparalleled style and innovation.
                        Whether you're a seasoned sneakerhead or just starting your collection,
                        our curated selection offers something for everyone. From classic designs to the latest drops,
                        we bring you the finest in comfort, craftsmanship, and cutting-edge trends.
                    </p>
                </div>
                <div class="main_image">
                    <img src="images/img1.png">
                </div>
            </div>
            <div class="social_icon">
                <i class="fa-brands fa-facebook"></i>
                <i class="fa-brands fa-twitter"></i>
                <i class="fa-brands fa-instagram"></i>
            </div>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search for shoes by name...">
                <button id="searchButton">Search</button>
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <div class="box">
        <div class="products" id="Prod">
            <h1>Latest & Greatest</h1>
            <div class="box">
                <% for (let i = 0; i < products.length; i++) { %>
                    <div class="card">
                        <div class="small_card">
                            <% if (isAuthenticated) { %>
                                <i class="fa-solid fa-heart" data-product-id="<%= products[i]._id %>"></i>
                            <% } %>
                        </div>
                        <div class="image">
                            <img src="<%= products[i].imageSrc %>" alt="<%= products[i].name %>">
                        </div>
                        <div class="product_text">
                            <h2><%= products[i].name %></h2>
                            <h3><%= products[i].price %></h3>
                            <a class="link" href="/shoe?id=<%= products[i].id %>">Show</a>
                            <% if (user && user.role === 'admin') { %>
                                <a class="link" href="/deleteshoe?id=<%= products[i].id %>">Delete</a>
                            <% } %>
                            <div class="stars">
                                <% for(let j = 0; j < products[i].rating; j++) { %>
                                    <i class="fa-solid fa-star"></i>
                                <% } %>
                            </div>
                            <% if (isAuthenticated) { %>
                                <a href="#" class="btn addToCartBtn" 
                                   data-id="<%= products[i]._id %>"
                                   data-name="<%= products[i].name %>" 
                                   data-price="<%= products[i].price %>" 
                                   data-image="<%= products[i].imageSrc %>">Add To Cart</a>
                            <% } else { %>
                                <a href="#" class="btn loginPrompt">Add To Cart</a>
                            <% } %>

                            <% if (isAuthenticated) { %>
                                <li><a href="#" id="orderHistoryLink">Order History</a></li>
                            <% } %>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    </div>

    
    <script id="userData" type="application/json">
        <%- JSON.stringify({ isAdmin: user && user.role === 'admin' }) %>
    </script>
    <script src="/js/shoes.js"></script>
</body>
</html>